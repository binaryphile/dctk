#!/usr/bin/env bash

[[ -n $_dctk_init ]] && return
readonly _dctk_init=loaded

source kzn.bash
initialize_kzn

prog=${_DCTK_PROG:-dctk}

define error_message <<'EOS'
# Load %s automatically by adding
# the following to %s:

eval "$(%s/bin/%s init -)"
EOS

main() {
  local libexec
  local path_format
  local print
  local profile
  local root
  local shell
  local shell_format

  libexec=$(realpath "$BASH_SOURCE")
  libexec=$(dirname "$libexec")
  root=$(absolute_path "$libexec"/../..)

  print=""
  is_same_as - "${1:-}" && { print=1; shift ;}

  shell=${1:-}
  is_given "$shell" || shell=$(basename "$SHELL")

  ! is_given "$print" && {
    case $shell in
      "bash" )
        # shellcheck disable=SC2088
        profile='~/.bash_profile'
        ;;
      "zsh" )
        # shellcheck disable=SC2088
        profile='~/.zshenv'
        ;;
      * )
        profile='your profile'
        ;;
      esac

    # shellcheck disable=SC2059,SC2154
    errexit "$(printf "$error_message\n" "$prog" "$profile" "$root" "$prog")"
  }

  # shellcheck disable=SC2016
  path_format='export PATH=$PATH:%q/bin'
  # shellcheck disable=SC2059,SC2154
  printf "$path_format\n" "$root"

  case $shell in
    "bash" | "zsh" )
      shell_format='source %q/completions/*.%q'
      # shellcheck disable=SC2059,SC2154
      printf "$shell_format\n" "$root" "$shell"
      ;;
  esac
}

return 0 2>/dev/null ||:

strict_mode on
main "$@"
